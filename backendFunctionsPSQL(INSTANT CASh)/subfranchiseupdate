CREATE OR REPLACE FUNCTION icashobj.subfranchiseupdate(
	solefranch numeric,
	franch numeric,
	subfranch numeric,
	longname character varying,
	shortname character varying,
	bank character,
	product character,
	profitpercentage numeric,
	localcurrency character varying,
	countrycode character varying,
	statecode character varying,
	citycode character varying,
	receivingcommission1 numeric,
	sendingcommission1 numeric,
	receivingcommission2 numeric,
	sendingcommission2 numeric,
	imsflag character,
	pernotnl numeric,
	directagent character,
	pernotnlamountlimit numeric,
	avaliablelimit numeric,
	transcationlimit numeric,
	accountbalance numeric,
	sendingamount numeric,
	receivingamount numeric,
	natureofp character varying,
	natureofc character varying,
	principalaccount character varying,
	commissionaccount character varying,
	agtchangecustrate character,
	hoacflag character,
	limitedaccount character,
	address1 character varying,
	address2 character varying,
	address3 character varying,
	phonenumber character varying,
	faxnumber character varying,
	emailaddress character varying,
	sendcommission1 numeric,
	sendcommission2 numeric,
	receivecommission1 numeric,
	receivecommission2 numeric,
	agentscode character varying,
	zipcode character varying,
	branchcode1 character varying,
	branch numeric,
	payingbranch character varying,
	branchcode2 character varying,
	branchcount character varying,
	sbranchcount character varying,
	agtmode character varying,
	dubaipolicefine character varying,
	sendcommissiongroup character varying,
	receivecommissiongroup character varying,
	sendrategroup character varying,
	receiverategroup character varying,
	settlegroup character varying,
	branchname character varying,
	swiftcode character varying,
	translimitusd numeric,
	accountbal numeric,
	avaliablelimitusd numeric,
	sendingamountusd numeric,
	receivedamountusd numeric,
	totalusd numeric,
	modify character,
	domesticallowled character,
	blockrelease character,
	webdisplay character,
	download character varying,
	autolmtupd character,
	usdprizeacc character varying,
	usdcommissionacc character varying,
	naturep character varying,
	naturec character varying,
	bankswiftcode character varying,
	countryswift character,
	accinwsfl character varying,
	dateformate character varying,
	holdlimitpercentage numeric,
	holdlimitflag character,
	timezone character varying,
	firstlvlagnt character,
	workinghrs character varying,
	restrictedip character varying,
	addlastchrge character varying,
	vatprintacc character varying,
	recordstatus character,
	authorizedstatus character)
    RETURNS character varying
    LANGUAGE 'plpgsql'

    COST 100
    VOLATILE 
AS $BODY$
DECLARE combinedcode numeric;
begin
	IF EXISTS(select * from icashobj.ictagetmp where agescd = solefranch AND agefcd = franch AND agesfc = subfranch) THEN
		update icashobj.ictagetmp set agebnk=bank, agewt3=product, agescm=profitpercentage, agerv1=receivingcommission1, agesv1=sendingcommission1, agerv2=receivingcommission2, 
									agesv2=sendingcommission2,agewt5=imsflag, agxen1=pernotnl, agxdir=directagent, agelus=pernotnlamountlimit, agetll=avaliablelimit, 
									agetrl=transcationlimit, ageacbo=accountbalance, agesam=sendingamount, ageram=receivingamount, agxbl1=natureofp, agxbl2=natureofc, 
									ageapa=principalaccount, ageaca=commissionaccount, agerca=agtchangecustrate,agxef5=hoacflag, agewt4=limitedaccount, agead1=address1, 
									agead2=address2,agead3=address3, ageph1=phonenumber, agefx1=faxnumber, ageema=emailaddress, agesv3=sendcommission1, agesv4=sendcommission2, 
									agerv3=receivecommission1, agerv4=receivecommission2,agettc=agentscode, agezpc=zipcode, agecd5=branchcode1, agebrn=branch, agecd7=payingbranch, 
									agecd6=branchcode2, agewt1=branchcount,agewt2=sbranchcount,agemod=agtmode, agxbl5=dubaipolicefine, agecd1=sendcommissiongroup, 
									agecd2=receivecommissiongroup, agxec1=sendrategroup, agxec2=receiverategroup, agecd9=settlegroup, agxbrn=branchname, agxswc=swiftcode, 
									agetru=translimitusd, ageacbn=accountbal, agetlu=avaliablelimitusd,agesau=sendingamountusd,agerau=receivedamountusd, ageluu=totalusd, 
									agewt6=modify, agxef4=domesticallowled, agest3=blockrelease, agxef3=webdisplay,agecd4=download,agxef2=autolmtupd,agebpa=usdprizeacc,
									agebca=usdcommissionacc,agxbl3=naturep,agxbl4=naturec,ageswc=bankswiftcode,ageswd=countryswift,agecds=accinwsfl,agedft=dateformate,
									agxhll=holdlimitpercentage,agxhlf=holdlimitflag,agetmz=timezone,agxef1=firstlvlagnt,agewhr=workinghrs,agxec3=restrictedip,agxec4=addlastchrge,
									agxec5=vatprintacc,agests=recordstatus,agxsts=authorizedstatus
							where agescd = solefranch AND agefcd = franch AND agesfc = subfranch returning ageccd into combinedcode;
							
	if(authorizedstatus = ' ') then
		update icashobj.ictage set agelnm=longname, agesnm=shortname, agebnk=bank, agewt3=product, agescm=profitpercentage, agelcd=localcurrency, agecnt=countrycode,
								   agestc=statecode, agecty=citycode, agerv1=receivingcommission1, agesv1=sendingcommission1, agerv2=receivingcommission2, agesv2=sendingcommission2,
								   agewt5=imsflag, agetme=directagent, agelus=pernotnlamountlimit, agetll=avaliablelimit, agetrl=transcationlimit, agewic=accountbalance, 
								   agesam=sendingamount, ageram=receivingamount, ageacu=natureofp, ageapu=natureofc, ageapa=principalaccount, ageaca=commissionaccount,
								   agerca=agtchangecustrate, agewt4=limitedaccount, agead1=address1, agead2=address2, agead3=address3, ageph1=phonenumber, agefx1=faxnumber, 
								   ageema=emailaddress, agesv3=sendcommission1, agesv4=sendcommission2, agerv3=receivecommission1, agerv4=receivecommission2, agettc=agentscode, 
								   agezpc=zipcode, agecd5=branchcode1, agebrn=branch, agecd7=payingbranch, agecd6=branchcode2, agewt1=branchcount, agewt2=sbranchcount, agemod=agtmode,
								   agedte=dubaipolicefine, agecd1=sendcommissiongroup, agecd2=receivecommissiongroup, agecd10=sendrategroup, agecd9=settlegroup, agewtm=branchname, 
								   agecd8=swiftcode, agetru=translimitusd, agetlu=avaliablelimitusd, agesau=sendingamountusd, agerau=receivedamountusd, ageluu=totalusd, 
								   agewt6=modify, agest3=blockrelease, agecd4=download, agechg=autolmtupd, agebpa=usdprizeacc, agebca=usdcommissionacc, ageusr=naturep, 
								   agedev=naturec, ageswc=bankswiftcode, ageswd=countryswift, agecds=accinwsfl, agedft=dateformate, agercm=holdlimitpercentage, agetmz=timezone, 
								   agecd3=firstlvlagnt, agewhr=workinghrs, agest2=recordstatus, agest1=authorizedstatus
							where agescd = solefranch AND agefcd = franch AND agesfc = subfranch;
	end if;

		insert into icashobj.ictagel(agescd,agefcd,agesfc,ageccd,agelnm,agesnm,agebnk,agewt3,agescm,agelcd,agecnt,agestc,agecty,agerv1,agesv1,agerv2,agesv2,agewt5,ageadj,agetme,
 									 agelus,agetll,agetrl,agewic,agesam,ageram,ageacu,ageapu,ageapa,ageaca,agerca,agemodtyp,agewt4,agead1,agead2,agead3,ageph1,agefx1,ageema,
 									 agesv3,agesv4,agerv3,agerv4,agettc,agezpc,agecd5,agebrn,agecd7,agecd6,agewt1,agewt2,agemod,agedte,agecd1,agecd2,agecd10,agectcd,agecd9,
 									 agewtm,agecd8,agetru,ageacb,agetlu,agesau,agerau,ageluu,agewt6,agest2,agest3,agest1,agecd4,agechg,agebpa,agebca,ageusr,agedev,ageswc,
 									 ageswd,agecds,agedft,agercm,ageupfl,agetmz,agecd3,agewhr,ageaddtim,ageadddat,ageaddusr)
 							values(solefranch,franch,subfranch,combinedcode,longname,shortname,bank,product,profitpercentage,localcurrency,countrycode,statecode,citycode,receivingcommission1,
 								   sendingcommission1,receivingcommission2,sendingcommission2,imsflag,pernotnl,directagent,pernotnlamountlimit,avaliablelimit,transcationlimit,
 								   accountbalance,sendingamount,receivingamount,natureofp,natureofc,principalaccount,commissionaccount,agtchangecustrate,hoacflag,limitedaccount,
 								   address1,address2,address3,phonenumber,faxnumber,emailaddress,sendcommission1,sendcommission2,receivecommission1,receivecommission2,agentscode,
 								   zipcode,branchcode1,branch,payingbranch,branchcode2,branchcount,sbranchcount,agtmode,dubaipolicefine,sendcommissiongroup,receivecommissiongroup,
 								   sendrategroup,receiverategroup,settlegroup,branchname,swiftcode,translimitusd,accountbal,avaliablelimitusd,sendingamountusd,receivedamountusd,
 								   totalusd,modify,domesticallowled,blockrelease,webdisplay,download,autolmtupd,usdprizeacc,usdcommissionacc,naturep,naturec,bankswiftcode,countryswift,
 								   accinwsfl,dateformate,holdlimitpercentage,holdlimitflag,timezone,firstlvlagnt,workinghrs,restrictedip,addlastchrge,vatprintacc);
		RETURN 'Updated Successfully';
	ELSE 
		RAISE EXCEPTION 'SFS doesnot exists';
	END IF;

end
$BODY$;
